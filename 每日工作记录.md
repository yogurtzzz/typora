2019/12/16

阅读TripStack的API接口文档

阅读供应商 “路淘” 的“搜索航班” 流程代码

在Play框架下编写代码，调通了TripStack的接口



2019/12/17

根据官方文档，继续学习Play框架

了解了Actor并发模型，ForkJoin

DDD领域模型设计？



2019/12/18

快速温习JAVA Tutorial

找出了获取供应商API地址的逻辑，使用的是play实现的JPA 支持

了解了member项目的相关内容



2019/12/19

申请开通member项目的相关gitee权限，完成项目导入，根据confluence上的api说明，开始梳理member中的接口和用户注册相关逻辑



将member-service模块的api接口处理逻辑全部过了一遍

学习JPA的相关知识

@Embedded  @Embedable

@OneToMany  @JoinColumn等



2019/12/20

进一步熟悉member项目，把该项目涉及到的表结构和关联关系梳理了一遍



==================

2019/12/23

查看member-web项目的代码



2019/12/24

学习了Spring的事件机制 ApplicationEvent的使用

了解了BloomFilter

学习了如何在本地配置2套git账户

阅读Spring in Action 5th edition ，看完了第一章

接到 “搜索比价” 工具这个需求





2019/12/25

梳理“搜索比价工具” 的开发需求，了解所涉及到的各个模块，以及调用关系

开始编写搜索比价工具





2019/12/30

入参校验     √完成

调下游http-flight-supplier进行任务分发   √完成

待进行:

1. 将task设置一个超时时长，任务提交后超过一定时间若还没有收到结果，则将数据库里该task的状态改为FAIL（需要使用延迟任务来实现，考虑用定时器，或者ScheduelThreadPool）   √已完成
2. 一个task对应一个供应商，每个task的航线都是相同的，每条航线需要指定几个航司，表示该条航线只取指定航司的机票查询结果
3. 将结果写到es
4. **后续进行模块的日志功能完善**



2019/12/31

成功收到了来自供应商的搜索结果

解决了昨天遗留的接收结果时的乱码问题，成功还原出响应报文

成功将响应报文里的字符串信息，转换为JAVA对象

学习jackson使用 https://www.yiibai.com/jackson/jackson_first_application.html

<https://blog.csdn.net/Ideality_hunter/article/details/53337535?locationNum=1&fps=1>



待解决：

1. 调下游http-flight-supplier服务时，传入的writerUrl，后续上SIT和UAT环境时，需要在marathon和kong上进行配置

2. ```
   //存疑，由于一个搜索任务会指定多个供应商，而下发任务是一个供应商下发一个任务
   //所以提交的一个搜索任务，会对应多个供应商任务
   //多个供应商任务的id，都为同一个taskId，不知是否会有问题？
   ```

3. 另，搜索结果已接收完毕，后续需要考虑，一个task，如何判断该task对应的所有供应商都已返回结果，此时才算该task完成（**需求中说某供应商如果没有结果，则显示N/A**,那么，task失败的判断标准改为：若该task下的所有供应商都无结果，则判断为`FAIL`），task完成后，还需对**每条航线进行 航司的过滤**，以及**codeShare**的条件过滤。需要存储每条航线和航司的一个映射关系

4. 如何调起kafka，往ES里塞查询结果的日志

5. 需求说不管供应商的配置，可以对所有供应商下发任务，有一些供应商在配置里是`DISABLED`的，虽然仍然可以向它们下发任务，但是它们不会给出响应，也就是说，下发的搜索任务中若包含这些供应商，那么任务一定是会失败的（超时未收到供应商的回复，则会将状态置为`FAIL`）**那就不存在这个问题了**

6. 保存任务信息到mysql时，创建人的id应该由前端传入

7. 后续添加日志

8. 







几点小问题：

1. 航线的数量限制应由前端控制（达到10条航线则隐藏航线按钮），后端是否还需再做航线数量的控制？

2. 供应商数量（最多可选择6个），也应由前端控制，后端是否还需再做控制？

3. 需求中说，所有供应商开关不影响任务下发（实际上，status为`DISABLED`的供应商，可能根本不会执行搜索，也不会通过writerURL对结果进行写回）。若下发的任务中指定了这类供应商，则这部分供应商的搜索结果一定是 N/A。需要知会

4. 另外一个小建议，前端页面中CodeShare选项，原先设定了2个值：No limit 和 Not allow。建议把值改为 Allowed 和Not allowed 这样，对页面使用人员，含义更加清晰。

5.  任务列表中，创建人的id，需要由前端人员在创建任务时在请求中带上

6. 关于task的状态，现定义了3种，SEARCHING，DONE，FAIL。说明如下：

   **一个task会下发给多个供应商去执行搜索**，会有个task超时时间的配置

   task的状态会在以下2种情况被置为DONE：

   - 在超时时间范围内，该task指定的所有供应商皆返回了结果

   - 达到超时时间限制，该task指定的供应商，至少有一个返回了结果

   task的状态被置为FAIL的情况：

   - 达到超时时间限制，该task指定的供应商，全部都没有返回结果

   页面只允许对状态为DONE的task进行信息查询

   请确认是否ok？

7. 和我对接的前端人员是？





2020/1/2

继续开发搜索比价模块

帮助运维同学查看member-service-new频繁报加解密错误的原因，并修复



2020/1/3

继续开发搜索比价模块，完成搜索结果的数据库表设计，搜索结果的解析和入库等操作，完成了自测

现在就差调kafka把搜索结果写到es



2020/1/6

在本地虚拟机搭了kafka环境，学习kafka的基本使用，以及es的数据结构

考虑如何将数据写入es，以及如何在kibana上将数据按指定格式导出

再次温习json的使用（使用jackson操作json）



增加一个选舱位，可选经济舱or商务舱，每次指定一个

完成将数据库的数据格式整理成前端需要展示的格式，完成数据的准备工作。

还差将数据发送给kafka这最后一步操作，以及需要确认发送到kafka的消息，在什么情况下会被写入到es